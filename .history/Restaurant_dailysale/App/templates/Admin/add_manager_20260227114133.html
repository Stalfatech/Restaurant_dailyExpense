{% extends "base.html" %}
{% load static %}
{% block 'content' %}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Add Manager</h4>
        <a href="{% url 'manager_view' %}" class="btn btn-secondary">
            ← Back to List
        </a>
    </div>

    <div class="card shadow">
        <div class="card-body">

            <p class="text-muted">
                Fields marked with <span class="text-danger">*</span> are mandatory.
            </p>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <form method="post" enctype="multipart/form-data" id="managerForm">
                {% csrf_token %}

                <div class="row">

                    <!-- Full Name -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Full Name <span class="text-danger">*</span>
                        </label>
                        <input type="text" name="name"
                               class="form-control" required>
                    </div>

                    <!-- Phone -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Phone <span class="text-danger">*</span>
                        </label>
                        <input type="tel" name="phone"
       class="form-control"
       value="{{ form_data.phone|default:'' }}"
       pattern="\+[0-9]{8,15}"
       placeholder="+971501234567"
       title="Enter phone number with country code (8–15 digits)"
       required>
                      <small class="text-muted">
    Enter phone number with country code (8–15 digits, e.g., +971501234567)
</small>
                    </div>

                    <!-- Date of Birth -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Date of Birth <span class="text-danger">*</span>
                        </label>
                        <input type="date" name="dob"
                               id="dob"
                               class="form-control"
                               required>
                    </div>

                    <!-- Gender -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Gender</label>
                        <select name="gender" class="form-control">
                            <option value="">Select</option>
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                        </select>
                    </div>

                    <!-- Address -->
                    <div class="col-md-12 mb-3">
                        <label class="form-label">
                            Address <span class="text-danger">*</span>
                        </label>
                        <textarea name="address"
                                  class="form-control"
                                  rows="3"
                                  required></textarea>
                    </div>

                    <!-- Joining Date -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Joining Date <span class="text-danger">*</span>
                        </label>
                        <input type="date" name="joining_date"
                               class="form-control"
                               required>
                    </div>

                    <!-- Gmail -->
                    <div class="col-md-6 mb-3">
    <label class="form-label">
        Gmail <span class="text-danger">*</span>
    </label>
    <input type="email"
           name="gmail"
           class="form-control"
           pattern="^[^@]+@[^@]+\.[^@]+$"
           required>
    <small class="text-muted">
        Enter valid email (must contain @)
    </small>
</div>
<!-- Branch -->
<div class="col-md-6 mb-3">
    <label class="form-label">
        Assign Branch <span class="text-danger">*</span>
    </label>
    <select name="branch" class="form-control" required>
        <option value="">Select Branch</option>
        {% for branch in branches %}
            <option value="{{ branch.id }}">
                {{ branch.name }} - {{ branch.location }}
            </option>
        {% endfor %}
    </select>
</div>

                    <!-- Password -->
                    <div class="col-md-6 mb-3">
    <label class="form-label">
        Password <span class="text-danger">*</span>
    </label>
    <input type="password"
           name="password"
           class="form-control"
           minlength="8"
           maxlength="8"
           required>
    <small class="text-muted">
        Password must be exactly 8 characters
    </small>
</div>

                    <!-- Photo -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Photo <span class="text-danger">*</span>
                        </label>
                        <input type="file"
                               name="photo"
                               class="form-control"
                               accept="image/png, image/jpeg, image/jpg"
                               required>
                        <small class="text-muted">
                            Only JPG, JPEG, PNG allowed
                        </small>
                    </div>

                </div>

                <button type="submit" class="btn btn-primary w-100">
                    Add Manager
                </button>

            </form>

        </div>
    </div>

</div>

<!-- JavaScript Validation -->
<script>
    // DOB should not be future date
    document.getElementById("dob").max = new Date().toISOString().split("T")[0];

    // Extra safety validation before submit
    document.getElementById("managerForm").addEventListener("submit", function(event) {
        let dob = document.getElementById("dob").value;
        let today = new Date().toISOString().split("T")[0];

        if (dob > today) {
            alert("Date of Birth cannot be a future date!");
            event.preventDefault();
        }
    });
</script>

{% endblock %}
