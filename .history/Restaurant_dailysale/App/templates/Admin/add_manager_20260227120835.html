{% extends "base.html" %}
{% load static %}
{% block 'content' %}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Add Manager</h4>
        <a href="{% url 'manager_view' %}" class="btn btn-secondary">
            ‚Üê Back to List
        </a>
    </div>

    <div class="card shadow">
        <div class="card-body">

            <p class="text-muted">
                Fields marked with <span class="text-danger">*</span> are mandatory.
            </p>

            <!-- Django Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <form method="post" enctype="multipart/form-data" id="managerForm">
                {% csrf_token %}

                <div class="row">

                    <!-- Full Name -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Full Name <span class="text-danger">*</span>
                        </label>
                        <input type="text" name="name"
                               class="form-control"
                               value="{{ form_data.name|default:'' }}"
                               required>
                    </div>

                    <!-- Phone -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Phone <span class="text-danger">*</span>
                        </label>
                        <input type="tel" name="phone"
           class="form-control {% if phone_error %}is-invalid{% endif %}"
           value="{{ form_data.phone|default:'' }}"
           placeholder="+971501234567"
           required>

    {% if phone_error %}
        <div class="invalid-feedback">
            {{ phone_error }}
        </div>
    {% else %}
        <small class="text-muted">
            Enter phone with country code (e.g., +971501234567)
        </small>
    {% endif %}
                    </div>

                    <!-- Date of Birth -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Date of Birth <span class="text-danger">*</span>
                        </label>
                        <input type="date" name="dob"
                               id="dob"
                               class="form-control"
                               value="{{ form_data.dob|default:'' }}"
                               required>
                    </div>

                    <!-- Gender -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Gender</label>
                        <select name="gender" class="form-control">
                            <option value="">Select</option>
                            <option value="Male" {% if form_data.gender == "Male" %}selected{% endif %}>Male</option>
                            <option value="Female" {% if form_data.gender == "Female" %}selected{% endif %}>Female</option>
                            <option value="Other" {% if form_data.gender == "Other" %}selected{% endif %}>Other</option>
                        </select>
                    </div>

                    <!-- Address -->
                    <div class="col-md-12 mb-3">
                        <label class="form-label">
                            Address <span class="text-danger">*</span>
                        </label>
                        <textarea name="address"
                                  class="form-control"
                                  rows="3"
                                  required>{{ form_data.address|default:'' }}</textarea>
                    </div>

                    <!-- Joining Date -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Joining Date <span class="text-danger">*</span>
                        </label>
                        <input type="date" name="joining_date"
                               class="form-control"
                               value="{{ form_data.joining_date|default:'' }}"
                               required>
                    </div>

                    <!-- Gmail -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Gmail <span class="text-danger">*</span>
                        </label>
                        <input type="email"
                               name="gmail"
                               class="form-control"
                               value="{{ form_data.gmail|default:'' }}"
                               required>
                        <small class="text-muted">
                            Enter valid email (must contain @)
                        </small>
                    </div>

                    <!-- Branch -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Assign Branch <span class="text-danger">*</span>
                        </label>
                        <select name="branch" class="form-control" required>
                            <option value="">Select Branch</option>
                            {% for branch in branches %}
                                <option value="{{ branch.id }}"
                                {% if form_data.branch == branch.id|stringformat:"s" %}selected{% endif %}>
                                    {{ branch.name }} - {{ branch.location }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Password -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Password <span class="text-danger">*</span>
                        </label>
                        <input type="password"
                               name="password"
                               class="form-control"
                               value="{{ form_data.password|default:'' }}"
                               minlength="8"
                               maxlength="8"
                               required>
                        <small class="text-muted">
                            Password must be exactly 8 characters
                        </small>
                    </div>

                    <!-- Photo -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Photo <span class="text-danger">*</span>
                        </label>
                        <input type="file"
                               name="photo"
                               class="form-control"
                               accept="image/png, image/jpeg, image/jpg"
                               required>
                        <small class="text-muted">
                            Only JPG, JPEG, PNG allowed
                        </small>
                    </div>

                </div>

                <button type="submit" class="btn btn-primary w-100">
                    Add Manager
                </button>

            </form>

        </div>
    </div>

</div>

<!-- JavaScript Validation -->
<script>
    // DOB should not be future date
    document.getElementById("dob").max = new Date().toISOString().split("T")[0];

    document.getElementById("managerForm").addEventListener("submit", function(event) {
        let dob = document.getElementById("dob").value;
        let today = new Date().toISOString().split("T")[0];

        if (dob > today) {
            alert("Date of Birth cannot be a future date!");
            event.preventDefault();
        }
    });
</script>

{% endblock %}