{% extends "base.html" %}
{% load static %}
{% block 'content' %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container-fluid mt-5">

    <!-- Header (Hidden While Printing) -->
    <div class="text-center mb-4 no-print">
        <h2 class="fw-bold">Daily Salary Report</h2>
    </div>

    <!-- ✅ Filter Section (Hidden While Printing) -->
    <form method="get" class="mb-4 no-print">
        <div class="row align-items-end g-3">

            <!-- Staff Name -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Staff Name</label>
                <input type="text"
                       name="staff"
                       value="{{ staff_name }}"
                       class="form-control"
                       placeholder="Enter staff name">
            </div>

            <!-- Select Date -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Select Date</label>
                <input type="date"
                       name="date"
                       value="{{ selected_date }}"
                       class="form-control">
            </div>

            <!-- Branch Filter -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Branch</label>
                <select name="branch" class="form-select">
                    <option value="">All Branches</option>
                    {% for branch in branches %}
                        <option value="{{ branch.id }}"
                            {% if selected_branch == branch.id|stringformat:"s" %}
                                selected
                            {% endif %}>
                            {{ branch.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Buttons -->
            <div class="col-md-3 d-flex gap-2">
                <button type="submit" class="btn btn-primary w-50">
                    Filter
                </button>

                <a href="{% url 'admin_daily_salary_list' %}"
                   class="btn btn-secondary w-50">
                    Clear
                </a>
            </div>

        </div>
    </form>

    <!-- Summary Cards -->
    <div class="row justify-content-center mb-4 g-3">

        <!-- Total Paid -->
        <div class="col-md-4">
            <div class="card shadow text-center border-0"
                 style="background:#0d6efd; color:white; border-radius:12px;">
                <div class="card-body py-4">
                    <h5 class="fw-semibold">Total Paid Salary</h5>
                    <h2 class="fw-bold mt-2">{{ total_paid }}</h2>
                </div>
            </div>
        </div>

        <!-- Total Advance -->
        <div class="col-md-4">
            <div class="card shadow text-center border-0"
                 style="background:#198754; color:white; border-radius:12px;">
                <div class="card-body py-4">
                    <h5 class="fw-semibold">Total Advance</h5>
                    <h2 class="fw-bold mt-2">{{ total_advance }}</h2>
                </div>
            </div>
        </div>
        

    </div>

    <!-- Salary Table -->
    <div class="card shadow">
        <div class="card-body p-0">

            <table class="table table-bordered mb-0 text-center">

                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Staff</th>
                        <th>Branch</th>
                        <th>Total Salary</th>
                        <th>Advance</th>
                        <th>Paid</th>
                        <th>Balance</th>
                        <th>Payment Mode</th>
                        <th>Payment Date</th>
                    </tr>
                </thead>

                <tbody>
                    {% for salary in salaries %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td class="text-start">{{ salary.staff.name }}</td>
                        <td>{{ salary.branch.name }}</td>
                        <td> {{ salary.salary_amount }}</td>
                        <td> {{ salary.adjusted_advance }}</td>
                        <td>₹ {{ salary.paid_amount }}</td>
                        <td>
                            {% if salary.balance_salary > 0 %}
                                ₹ {{ salary.balance_salary }}
                            {% else %}
                                <span class="badge bg-success">Cleared</span>
                            {% endif %}
                        </td>
                        <td>{{ salary.payment_mode }}</td>
                        <td>{{ salary.payment_date }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9" class="py-3">
                            No salary records found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>

        </div>
    </div>

    <!-- Print Button (Hidden While Printing) -->
    <div class="text-end mt-3 no-print">
        <button onclick="window.print()" class="btn btn-success">
            Print Report
        </button>
    </div>

</div>

<style>

/* Table Styling */
th, td {
    white-space: nowrap;
    padding: 12px 20px !important;
    font-size: 15px;
}

/* Remove horizontal scroll */
body {
    overflow-x: hidden;
}

/* PRINT SETTINGS */
@media print {

    @page {
        size: A4 landscape;
        margin: 12mm;
    }

    .no-print {
        display: none !important;
    }

    body {
        background: white !important;
    }

    table {
        width: 100% !important;
        font-size: 14px;
    }

    th, td {
        white-space: nowrap;
        padding: 14px 24px !important;
    }

    .card {
        border: none !important;
        box-shadow: none !important;
    }

}

</style>


{% endblock %}