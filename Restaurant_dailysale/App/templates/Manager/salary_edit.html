{% extends "base.html" %}
{% load static %}
{% block 'content' %}

<div class="container mt-4">
<div class="card shadow border-0 rounded-4">

<div class="card-header bg-dark text-white">
<h5 class="mb-0">Edit Salary</h5>
</div>

<div class="card-body">

<form method="post">
{% csrf_token %}

<div class="row g-3">

<!-- Staff (readonly) -->
<div class="col-md-6">
<label class="form-label">Staff</label>
<input type="text" class="form-control" value="{{ salary.staff.name }}" readonly>
</div>

<div class="col-md-6">
<label class="form-label">Salary Period</label>
<input type="text" class="form-control"
       value="{{ salary.salary_month }} {{ salary.salary_year }}"
       readonly>
</div>

<div class="col-md-6">
<label class="form-label">Salary Amount</label>
<input type="number" step="0.01"
       name="salary_amount"
       id="salary_amount"
       class="form-control"
       value="{{ salary.salary_amount }}">
</div>

<div class="col-md-6">
<label class="form-label">Already Taken Advance (Total)</label>
<input type="text"
       id="total_advance"
       class="form-control bg-light"
       value="{{ total_advance }}"
       readonly>
</div>

<div class="col-md-6">
<label class="form-label">Add New Advance</label>
<input type="number" step="0.01"
       name="salary_advance"
       id="new_advance"
       class="form-control"
       placeholder="Enter new advance">
</div>

{% comment %} <div class="col-md-6">
<label class="form-label">Paid Amount</label>
<input type="number" step="0.01"
       name="paid_amount"
       id="paid_amount"
       class="form-control"
       value="{{ salary.paid_amount }}">
</div> {% endcomment %}

<!-- Already Paid -->
<div class="col-md-6">
<label class="form-label fw-semibold">Already Paid</label>
<input id="already_paid"
type="number"
class="form-control"
value="{{ salary.paid_amount }}"
readonly>
</div>

<!-- Pay Now -->
<div class="col-md-6">
    <label for="pay_now" class="form-label fw-semibold">Pay Now</label>
    <input 
        id="pay_now"
        type="number"
        step="0.01"
        name="paid_amount"
        class="form-control"
        placeholder="Enter amount"
        min="0"
    >
</div>



<div class="col-md-6">
<label class="form-label">Next Month Advance</label>
<input type="number" step="0.01"
       name="next_month_advance"
       class="form-control"
       value="{{ salary.next_month_advance_amount }}">
</div>

<div class="col-md-6">
<label class="form-label">Balance (Preview)</label>
<input type="text"
       id="balance_preview"
       class="form-control bg-light"
       readonly>
</div>

<div class="col-md-6">
<label class="form-label">Payment Date</label>
<input type="date"
       name="payment_date"
       class="form-control"
       value="{{ salary.payment_date|date:'Y-m-d' }}">
</div>

<div class="col-md-6">
<label class="form-label">Payment Mode</label>
<select name="payment_mode" class="form-select">
<option value="">Select</option>
<option value="Cash" {% if salary.payment_mode == 'Cash' %}selected{% endif %}>Cash</option>
<option value="Bank" {% if salary.payment_mode == 'Bank' %}selected{% endif %}>Bank</option>
</select>
</div>

</div>


</tbody>
</table>

<div class="text-end mt-3">
     <a href="{% url 'salary_list' %}" class="btn btn-secondary me-2">
    <i class="bi bi-arrow-left me-1"></i> Back to List
  </a>
<button class="btn btn-dark">Update Salary</button>
</div>

</form>

</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const salaryInput = document.getElementById("salary_amount");
    const alreadyPaidInput = document.getElementById("already_paid");
    const payNowInput = document.getElementById("pay_now");
    const balancePreview = document.getElementById("balance_preview");
    const balanceHidden = document.getElementById("balance_hidden");

    function calculateBalance() {
        const salary = parseFloat(salaryInput.value) || 0;
        const alreadyPaid = parseFloat(alreadyPaidInput.value) || 0;
        const payNow = parseFloat(payNowInput.value) || 0;

        let balance = salary - (alreadyPaid + payNow);

        if (balance < 0) balance = 0;

        // Update visible preview and hidden input
        balancePreview.value = balance.toFixed(2);
        if (balanceHidden) balanceHidden.value = balance.toFixed(2);
    }

    // Listen for changes
    payNowInput.addEventListener("input", calculateBalance);
    salaryInput.addEventListener("input", calculateBalance);
    alreadyPaidInput.addEventListener("input", calculateBalance);

    // Initial calculation
    calculateBalance();
});
</script>


{% endblock %}